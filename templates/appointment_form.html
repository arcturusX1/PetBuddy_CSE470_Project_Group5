{% extends "base.html" %}
{% block content %}
<body>
    <div class="form-container">
        <h2>Doctor Appointment Form</h2>
        <form method="POST">
            {{ form.hidden_tag() }}

            <div class="form-group">
                {{ form.vet_name.label(class="form-label") }}
                {{ form.vet_name(class="form-control", readonly=True) }}
            </div>

            <div class="form-group">
                {{ form.speciality.label(class="form-label") }}
                {{ form.speciality(class="form-control", readonly=True) }}
            </div>

            <div class="form-group">
                {{ form.workplace.label(class="form-label") }}
                {{ form.workplace(class="form-control", readonly=True) }}
            </div>

            <div class="form-group">
                {{ form.fees.label(class="form-label") }}
                {{ form.fees(class="form-control", readonly=True) }}
            </div>

            <div class="form-group">
                {{ form.date.label(class="form-label") }}
                {{ form.date(class="form-control", id="date-picker") }}
            </div>

            <div class="form-group">
                {{ form.time.label(class="form-label") }}
                <select id="time-select" name="time" class="form-control" required>
                    <option value="">Select a time</option>
                </select>
            </div>

            <div class="form-group">
                {{ form.submit(class="btn btn-primary") }}
            </div>
        </form>
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                var vetAvailability = JSON.parse('{{ availability | tojson | safe }}');
                console.log('vetAvailability:', vetAvailability);
                populateDateField(vetAvailability);
            });
            function populateDateField(availability) {
                var dateInput = document.getElementById('date-picker');
                var availableDays = Object.keys(availability);
                
                // Get today's date and set it as the minimum date
                var today = new Date();
                var minDate = today.toISOString().split('T')[0];
                dateInput.min = minDate;
                
                // Set max date to 3 months from now (you can adjust this as needed)
                var maxDate = new Date(today.setMonth(today.getMonth() + 3)).toISOString().split('T')[0];
                dateInput.max = maxDate;

                dateInput.addEventListener('input', function(e) {
                    var selectedDate = new Date(e.target.value);
                    var dayOfWeek = selectedDate.toLocaleDateString('en-US', { weekday: 'long' }).toLowerCase();
                    
                    if (!availableDays.includes(dayOfWeek)) {
                        e.target.value = '';
                        alert('This day is not available. Available days are: ' + availableDays.join(', '));
                        return;
                    }
                    
                    // Populate time slots for the selected day
                    populateTimeSlotsField(dayOfWeek, availability);
                });
            }
            function populateTimeSlotsField(selectedDay, vetAvailability) {
                var timeSlotsField = document.getElementById('time-select');
                
                // Clear the existing options
                timeSlotsField.innerHTML = '<option value="">--Select a Time Slot--</option>';
                
                // Get the time slots for the selected day
                var timeSlots = vetAvailability[selectedDay] || [];

                // Populate the dropdown with the time slots for the selected day
                timeSlots.forEach(function(timeSlot) {
                    var option = document.createElement('option');
                    option.value = timeSlot[0] + ' - ' + timeSlot[1];
                    option.text = timeSlot[0] + ' - ' + timeSlot[1];
                    timeSlotsField.appendChild(option);
                });
            }
        </script>
    </body>
</div>
{% endblock %}